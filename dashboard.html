<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard Inventaris TKJ</title>
  <link rel="stylesheet" href="style.css" />
  <!-- SheetJS CDN untuk export XLSX -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
<script>
  // guard sederhana: jika belum login -> kembali ke index
  (function(){
    const role = localStorage.getItem('userRole');
    if (!role) { location.href = 'index.html'; }
  })();
</script>

  <div class="container">
    <h1>Dashboard Inventaris Peralatan TKJ</h1>
    <button class="logout" onclick="logout()">Logout</button>

    <!-- Statistik ringkas (opsi C: tampilkan statistik) -->
    <div class="stats" id="admin-stats">
      <div class="box">Total Barang: <span id="total">0</span></div>
      <div class="box">Baik: <span id="baik">0</span></div>
      <div class="box">Rusak: <span id="rusak">0</span></div>
      <div class="box">Dipinjam: <span id="pinjam">0</span></div>
    </div>

    <!-- Form tambah / edit (hanya admin) -->
    <div class="form-container" id="admin-form">
      <h2>Tambah / Edit Peralatan</h2>
      <form id="form">
        <input type="hidden" id="form-id" />
        <input type="text" id="form-nisn" placeholder="NISN (opsional)" />
        <input type="text" id="form-nama" placeholder="Nama Peralatan" required />
        <input type="text" id="form-kode" placeholder="Kode / Serial" required />
        <input type="number" id="form-jumlah" placeholder="Jumlah" required min="1" />
        <select id="form-status">
          <option value="Baik">Baik</option>
          <option value="Rusak">Rusak</option>
          <option value="Dipinjam">Dipinjam</option>
        </select>

        <!-- Foto barang: upload file (simpan base64 di hidden input) -->
        <div style="margin:10px 0;display:flex;gap:12px;align-items:center;">
          <div>
            <label for="form-foto-file">Foto Barang</label><br />
            <input type="file" id="form-foto-file" accept="image/*" />
            <input type="hidden" id="form-foto" />
          </div>
          <div>
            <img id="preview" src="" alt="Preview" style="max-width:140px;max-height:100px;border-radius:6px;display:none;" />
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <button type="submit">Simpan</button>
          <button type="button" onclick="resetForm()">Batal</button>
        </div>
      </form>
    </div>

    <div class="buttons-row" id="admin-buttons">
      <button onclick="exportCSV()" class="excel-btn">Export CSV</button>
      <button onclick="exportXLSX()" class="excel-btn">Export XLSX</button>
      <button id="history-btn" onclick="window.location.href='history.html'" class="excel-btn">Riwayat Peminjaman</button>
      <!-- QR & paste features intentionally removed for this build -->
    </div>

    <!-- FORM KHUSUS USER: buat permintaan pinjam (hanya untuk role 'user') -->
    <div id="borrow-container" class="form-container" style="display:none;margin-bottom:12px">
      <h2>Formulir Permintaan Pinjam</h2>
      <form id="borrow-form">
        <input type="text" id="pinjam-nama" placeholder="Nama Barang / Deskripsi" required />
        <input type="text" id="pinjam-kode" placeholder="Kode / Serial (opsional)" />
        <input type="number" id="pinjam-jumlah" placeholder="Jumlah" required min="1" />
        <input type="text" id="pinjam-alasan" placeholder="Alasan / Lokasi pemakaian" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button type="submit">Kirim Permintaan</button>
          <button type="button" onclick="document.getElementById('borrow-form').reset()">Batal</button>
        </div>
      </form>
      <p class="note">Permintaan Anda akan tersimpan dan dapat diverifikasi oleh admin.</p>
    </div>

    <!-- Tabel inventaris -->
    <h2 id="table-title">Daftar Inventaris</h2>
    <div class="table-container" id="inventory-table">
      <table>
        <thead>
          <tr>
            <th>Foto</th>
            <th>NISN</th>
            <th>Nama</th>
            <th>Kode</th>
            <th>Jumlah</th>
            <th>Status</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="tabel-body"></tbody>
      </table>
    </div>
  </div>

  <!-- Notifikasi (harus diload sebelum script utama karena script utama memanggil fungsi notif) -->
  <script src="notif.js"></script>
  <script src="ui-anim.js"></script>

  <!-- main scripts -->
  <script src="history.js"></script>
  <script src="script.js"></script>
  <script>
  function logout() {
    localStorage.removeItem('userRole');
    localStorage.removeItem('username');
    localStorage.removeItem('login');      // jika masih ada sisa sistem login lama
    location.href = 'index.html';
  }
</script>

</body>
</html>
